flowchart TB
    subgraph ClientLayer["Client Layer"]
        WebApp["ğŸŒ Web Application<br/>(React/Next.js)"]
        MobileApp["ğŸ“± Mobile App<br/>(React Native)"]
        POS["ğŸ’³ POS Terminal<br/>(Electron)"]
        KDS["ğŸ³ Kitchen Display<br/>(React)"]
        DriverApp["ğŸš— Driver App<br/>(React Native)"]
    end

    subgraph CDN["Content Delivery"]
        CloudFront["â˜ï¸ CloudFront CDN"]
        S3Media["ğŸ“¦ S3 Media Bucket"]
    end

    subgraph Gateway["API Gateway Layer"]
        ALB["âš–ï¸ Application Load Balancer"]
        WAF["ğŸ›¡ï¸ AWS WAF"]
        RateLimit["ğŸš¦ Rate Limiter"]
    end

    subgraph AuthLayer["Authentication Layer"]
        Auth0["ğŸ” Auth0 / Cognito"]
        JWT["ğŸ« JWT Validator"]
        RBAC["ğŸ‘¤ RBAC Middleware"]
    end

    subgraph APILayer["API Layer (Node.js/NestJS)"]
        TenantResolver["ğŸ¢ Tenant Resolver"]
        
        subgraph CoreAPI["Core Services"]
            AuthAPI["Auth Service"]
            UserAPI["User Service"]
            NotificationAPI["Notification Service"]
        end
        
        subgraph BusinessAPI["Business Services"]
            MenuAPI["Menu Service"]
            OrderAPI["Order Service"]
            InventoryAPI["Inventory Service"]
            ReservationAPI["Reservation Service"]
            CRMAPI["CRM Service"]
        end
        
        subgraph OperationsAPI["Operations Services"]
            POSAPI["POS Service"]
            KDSAPI["KDS Service"]
            DeliveryAPI["Delivery Service"]
            HRMAPI["HRM Service"]
        end
        
        subgraph IntegrationAPI["Integration Services"]
            PaymentAPI["Payment Gateway"]
            FiscalAPI["Fiscal Service"]
            SMSAPI["SMS/Email Service"]
            GeoAPI["Geocoding Service"]
        end
    end

    subgraph MessageQueue["Message Queue Layer"]
        SQS["ğŸ“¬ AWS SQS"]
        EventBridge["ğŸ”” EventBridge"]
        
        subgraph Workers["Background Workers"]
            StockWorker["ğŸ“Š Stock Alert Worker"]
            ReservationWorker["ğŸ“… Reservation Worker"]
            ReportWorker["ğŸ“ˆ Report Generator"]
            NotificationWorker["ğŸ“§ Notification Worker"]
        end
    end

    subgraph DataLayer["Data Layer"]
        subgraph Primary["Primary Database"]
            PostgreSQL[("ğŸ˜ PostgreSQL 15<br/>+ PostGIS")]
        end
        
        subgraph Cache["Cache Layer"]
            Redis[("âš¡ Redis Cluster")]
            ElastiCache["Session Store"]
        end
        
        subgraph Search["Search Engine"]
            OpenSearch["ğŸ” OpenSearch"]
        end
        
        subgraph Analytics["Analytics"]
            Redshift[("ğŸ“Š Redshift")]
            QuickSight["ğŸ“ˆ QuickSight"]
        end
    end

    subgraph External["External Services"]
        Stripe["ğŸ’³ Stripe"]
        Twilio["ğŸ“± Twilio"]
        SendGrid["ğŸ“§ SendGrid"]
        GoogleMaps["ğŸ—ºï¸ Google Maps"]
        Firebase["ğŸ”¥ Firebase<br/>(Push Notifications)"]
    end

    subgraph Monitoring["Observability"]
        CloudWatch["ğŸ“Š CloudWatch"]
        XRay["ğŸ”¬ X-Ray Tracing"]
        Sentry["ğŸ› Sentry"]
        DataDog["ğŸ“ˆ DataDog"]
    end

    %% Client connections
    WebApp --> CloudFront
    MobileApp --> ALB
    POS --> ALB
    KDS --> ALB
    DriverApp --> ALB
    
    CloudFront --> S3Media
    CloudFront --> ALB
    
    %% Gateway flow
    ALB --> WAF
    WAF --> RateLimit
    RateLimit --> Auth0
    
    %% Auth flow
    Auth0 --> JWT
    JWT --> RBAC
    RBAC --> TenantResolver
    
    %% API routing
    TenantResolver --> CoreAPI
    TenantResolver --> BusinessAPI
    TenantResolver --> OperationsAPI
    TenantResolver --> IntegrationAPI
    
    %% Data connections
    CoreAPI --> PostgreSQL
    BusinessAPI --> PostgreSQL
    OperationsAPI --> PostgreSQL
    IntegrationAPI --> PostgreSQL
    
    CoreAPI --> Redis
    BusinessAPI --> Redis
    OperationsAPI --> Redis
    
    BusinessAPI --> OpenSearch
    
    %% Queue connections
    BusinessAPI --> SQS
    OperationsAPI --> SQS
    SQS --> Workers
    Workers --> PostgreSQL
    
    EventBridge --> Workers
    
    %% External integrations
    PaymentAPI --> Stripe
    SMSAPI --> Twilio
    SMSAPI --> SendGrid
    GeoAPI --> GoogleMaps
    NotificationAPI --> Firebase
    
    %% Analytics pipeline
    PostgreSQL -.-> Redshift
    Redshift --> QuickSight
    
    %% Monitoring
    APILayer --> CloudWatch
    APILayer --> XRay
    APILayer --> Sentry
    DataLayer --> DataDog
